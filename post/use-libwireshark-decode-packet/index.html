<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans|Marcellus+SC'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <link rel="stylesheet" href="http://sunwxg.github.io/css/styles.css">
    <link rel="stylesheet" href="http://sunwxg.github.io/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://sunwxg.github.io//index.xml">

    
    <title>Use libwireshark decoding PACP files - Sun Wang&#39;s Blog</title>
    <meta property='og:title' content="Use libwireshark decoding PACP files - Sun Wang&#39;s Blog">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://sunwxg.github.io/post/use-libwireshark-decode-packet/">
    
    

  </head>

  <body class="">

    <header class="site">
      <nav class="navbar navbar-default">
	<div class="container">
	  <div class="navbar-header">
	    <a class="navbar-brand" href="http://sunwxg.github.io/">Sun Wang&#39;s Blog</a>
	    
	    
	  </div>

	  
	  <a class="navbar-brand navbar-right" href="http://sunwxg.github.io/about/">About</a>
	  <a class="navbar-text" href="https://github.com/sunwxg">github</a>

	</div>
      </nav>
    </header>

      <div class="container">
    <div class="site">



<div class="single">

  <div class="row">
    <div class="col-md-8">

      <article class="single" itemscope="itemscope" itemtype="http://schema.org/Article">

        <meta itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" content="http://sunwxg.github.io/"/>
        <meta itemprop="dateModified" content="2016-03-23T00:00:00&#43;00:00">
        <meta itemprop="headline" content="Use libwireshark decoding PACP files">
        <meta itemprop="description" content="We use Wireshark tool to decode IP packet and analyse signaling. If we want to write our own tool to decode packet, we can use libwireshark library. First do some initial work. init_process_policies(); epan_init(register_all_protocols, register_all_protocol_handoffs, NULL, NULL); /* cfile is a global varible */ cap_file_init(&amp;cfile); cfile.filename = filename; cfile.count = 0; cfile.epan = epan_new(); cfile.epan-&gt;data = &amp;cfile; cfile.epan-&gt;get_frame_ts = tshark_get_frame_ts; Second read and decode packet. epan_dissect_t *edt; /* all the decoded data store in struct edt */ read_packet(&amp;edt); Print out packet.">
        <meta itemprop="url" content="http://sunwxg.github.io/post/use-libwireshark-decode-packet/">
        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="http://sunwxg.github.io/images/default.jpg" />
          <meta itemprop="width" content="800">
          <meta itemprop="height" content="800">
        </div>
        <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
          <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <meta itemprop="url" content="http://sunwxg.github.io/images/logo.jpg">
            <meta itemprop="width" content="100">
            <meta itemprop="height" content="100">
          </div>
          <meta itemprop="name" content="Sun Wang&#39;s Blog">
        </div>
        <div itemprop="author" itemscope itemtype="https://schema.org/Person">
          <meta itemprop="name" content="">
        </div>

        <header class="article-header">
          <time itemprop="datePublished" pubdate="pubdate" datetime="2016-03-23T00:00:00&#43;00:00">Wed, Mar 23, 2016</time>
          <h1 class="article-title">Use libwireshark decoding PACP files</h1>
        </header>

        <div class="article-body" itemprop="articleBody">
          <p>We use Wireshark tool to decode IP packet and analyse signaling. If we want to write our own tool to decode packet, we can use libwireshark library.</p>

<p>First do some initial work.</p>

<pre><code class="language-C">	init_process_policies();

	epan_init(register_all_protocols, register_all_protocol_handoffs, NULL, NULL);

	/* cfile is a global varible */
	cap_file_init(&amp;cfile);
	cfile.filename = filename;

	cfile.count = 0;
	cfile.epan = epan_new();
	cfile.epan-&gt;data = &amp;cfile;
	cfile.epan-&gt;get_frame_ts = tshark_get_frame_ts;
</code></pre>

<p>Second read and decode packet.</p>

<pre><code class="language-C">	epan_dissect_t *edt;

	/* all the decoded data store in struct edt */
	read_packet(&amp;edt);
</code></pre>

<p>Print out packet.</p>

<pre><code class="language-C">	/* print out as XML format */
	proto_tree_write_pdml(edt, stdout);

	/* print out as TEXT format */
	proto_tree_print(&amp;print_args, edt, print_stream);
</code></pre>

<p>Release memory.</p>

<pre><code class="language-C">	epan_dissect_free(edt);
	edt = NULL;

	free_frame_data_sequence(cfile.frames);
	cfile.frames = NULL;

	wtap_close(cfile.wth);
	cfile.wth = NULL;

	epan_free(cfile.epan);

	epan_cleanup();
</code></pre>

<p>My source code is on <strong><a href="https://github.com/sunwxg/decode_by_libwireshark">github</a></strong>. You can follow the guide to run and debug.</p>

        </div>


	<aside>
	  <div class="section">Tags:
	   <a href="http://sunwxg.github.io/tags/wireshark" class="section">wireshark</a> 

	  </div>
	</aside>

      </article>

    </div>
    <div class="col-md-4">
      
<aside class="site">

  
    
      
    
    
      
      
      
      
      
      
      
    
  

  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">category</h2>
    </div>
    <div class="list-group">
      
      <a href="http://sunwxg.github.io/categories/blog" class="list-group-item">blog</a>
      
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">tag</h2>
    </div>
    <div class="list-group">
      
      <a href="http://sunwxg.github.io/tags/jekyll" class="list-group-item">jekyll</a>
      
      <a href="http://sunwxg.github.io/tags/wireshark" class="list-group-item">wireshark</a>
      
    </div>
  </div>
  

</aside>


    </div>
  </div>

</div>

      </div>
    </div>

    <footer class="site">
      <div class="container">
        <p>&copy; 2016 Sun Wang&#39;s Blog</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>,</p>
        <p>Theme <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank">Beg</a> designed by <a href="http://yet.unresolved.xyz" target="_blank">Daisuke Tsuji</a></p>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    

  </body>
</html>

