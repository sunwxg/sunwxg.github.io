<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="stylesheet" href="http://sunwxg.github.io/css/bootstrap-3.3.6.min.css">
    <link rel="stylesheet" href="http://sunwxg.github.io/css/font-awesome-4.5.0.min.css">
    <link rel="stylesheet" href="http://sunwxg.github.io/css/theme_style.css">
    

    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://sunwxg.github.io//index.xml">

    
    <title>Libwireshark Decoded Data Struct - Sun Wang&#39;s Blog</title>
    <meta property='og:title' content="Libwireshark Decoded Data Struct - Sun Wang&#39;s Blog">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://sunwxg.github.io/post/libwireshark-decoded-data/">
    
    
</head>

<body>


    <div class="container">

      
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://sunwxg.github.io/">Sun Wang&#39;s Blog</a>
          </div>

	<a class="navbar-brand navbar-right" href="http://sunwxg.github.io/about/">About</a>
	<a class="navbar-text" href="https://github.com/sunwxg">github</a>
      </nav>


<div class="row">
    <div class="col-lg-8">

        <article class="single well" itemscope="itemscope" itemtype="http://schema.org/Article">
            <meta itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" content="http://sunwxg.github.io/"/>
            <meta itemprop="dateModified" content="2016-04-11T00:00:00&#43;00:00">
            <meta itemprop="headline" content="Libwireshark Decoded Data Struct">
            <meta itemprop="description" content="When using libwireshark library decoding packet, the decoded data is stored in struct epan_dissect. We can browse this struct to search or display packet data. struct epan_dissect { struct epan_session *session; tvbuff_t *tvb; proto_tree *tree; packet_info pi; }; epan_dissect-&gt;tree points to data struct tree. typedef proto_node proto_tree; typedef struct _proto_node { struct _proto_node *first_child; struct _proto_node *last_child; struct _proto_node *next; struct _proto_node *parent; field_info *finfo; tree_data_t *tree_data; } proto_node; typedef struct field_info { header_field_info *hfinfo; /**&lt; pointer to registered field information */ ...">
            <meta itemprop="url" content="http://sunwxg.github.io/post/libwireshark-decoded-data/">
            <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
                <meta itemprop="url" content="http://sunwxg.github.io/images/default.jpg" />
                <meta itemprop="width" content="800">
                <meta itemprop="height" content="800">
            </div>
            <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
                <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                    <meta itemprop="url" content="http://sunwxg.github.io/images/logo.jpg">
                    <meta itemprop="width" content="100">
                    <meta itemprop="height" content="100">
                </div>
                <meta itemprop="name" content="Sun Wang&#39;s Blog">
            </div>
            <div itemprop="author" itemscope itemtype="https://schema.org/Person">
                <meta itemprop="name" content="">
            </div>

            <header class="article-header">
                <h1>Libwireshark Decoded Data Struct</h1>
                
                <time itemprop="datePublished" pubdate="pubdate" datetime="2016-04-11T00:00:00&#43;00:00"><i class="fa fa-clock-o"></i> Posted on April 11, 2016</time>
                

                <div class="fa fa-tags">
                 <a href="http://sunwxg.github.io/tags/wireshark" class="tag">wireshark</a> 
		</div>

            </header>

            <p><p>When using libwireshark library decoding packet, the decoded data is stored in <code>struct epan_dissect</code>.
We can browse this struct to search or display packet data.</p>

<pre><code>struct epan_dissect {
	struct epan_session *session;
	tvbuff_t	*tvb;
	proto_tree	*tree;
	packet_info	pi;
};
</code></pre>

<p><code>epan_dissect-&gt;tree</code> points to data struct tree.</p>

<pre><code>typedef proto_node proto_tree;
typedef struct _proto_node {
	struct _proto_node *first_child;
	struct _proto_node *last_child;
	struct _proto_node *next;
	struct _proto_node *parent;
	field_info  *finfo;
	tree_data_t *tree_data;
} proto_node;
</code></pre>

<pre><code>typedef struct field_info {
	header_field_info	*hfinfo; /**&lt; pointer to registered field information */
	...
	fvalue_t		 value;
} field_info;
</code></pre>

<pre><code>typedef struct _header_field_info header_field_info;
struct _header_field_info {
	const char	*name;    /**&lt; [FIELDNAME] full name of this field */
	const char	*abbrev;  /**&lt; [FIELDABBREV] abbreviated name of this field */
	...
};
</code></pre>

<p>Every node of tree stores one information of packet.
The information includes name and value.
For example if we want to find IP source address, the name is <code>ip.src</code>, value is like <code>192.168.1.1</code>.</p>

<p>The name is stored in <code>epan_dissect-&gt;tree-&gt;finfo-&gt;hfinfo-&gt;abbrev</code>.</p>

<p>The value is stored in <code>epan_dissect-&gt;tree-&gt;finfo-&gt;value</code>.
We can use function <code>fvalue_to_string_repr</code> to convert value to display format.</p>

<pre><code>const char *name = node-&gt;finfo-&gt;hfinfo-&gt;abbrev;

fvalue_t fv = node-&gt;finfo-&gt;value;
char *value = fvalue_to_string_repr(&amp;fv, FTREPR_DISPLAY, NULL);
</code></pre>

<p>After browsing the node of tree, we can print out the data of packet like this.</p>

<pre><code>[ip]
. [ip.version] 4
. [ip.hdr_len] 20
. [ip.dsfield] 0
. . [ip.dsfield.dscp] 0
. . [ip.dsfield.ecn] 0
. [ip.len] 160
. [ip.id] 24538
. [ip.flags] 0
. . [ip.flags.rb] 0
. . [ip.flags.df] 0
. . [ip.flags.mf] 0
. [ip.frag_offset] 0
. [ip.ttl] 64
. [ip.proto] 132
. [ip.checksum] 15303
. . [ip.checksum_good] 0
. . [ip.checksum_bad] 0
. [ip.src] 10.128.228.50
. [ip.addr] 10.128.228.50
. [ip.src_host] 10.128.228.50
. [ip.host] 10.128.228.50
. [ip.dst] 10.128.229.6
. [ip.addr] 10.128.229.6
. [ip.dst_host] 10.128.229.6
. [ip.host] 10.128.229.6
</code></pre>

<p>You can get full source code from <a href="https://github.com/sunwxg/libwireshark_decoded_data.git">https://github.com/sunwxg/libwireshark_decoded_data.git</a>.
If you want know how libwireshark decodes packet, you can referece another blog <a href="http://sunwxg.github.io/post/use-libwireshark-decode-packet/">Use libwireshark decoding PCAP files</a></p>
</p>

        </article>

    </div>
    <aside class="col-md-4">

  
  <div class="well">
    <h3 class="text-capitalize">category</h3>
    <ul class="list-unstyled">
      
      <li><a href="http://sunwxg.github.io/categories/blog">blog<sup>10</sup></a></li>
      
    </ul>
  </div>
  
  <div class="well">
    <h3 class="text-capitalize">tag</h3>
    <ul class="list-unstyled">
      
      <li><a href="http://sunwxg.github.io/tags/driver">driver<sup>1</sup></a></li>
      
      <li><a href="http://sunwxg.github.io/tags/jekyll">jekyll<sup>1</sup></a></li>
      
      <li><a href="http://sunwxg.github.io/tags/kernel">kernel<sup>2</sup></a></li>
      
      <li><a href="http://sunwxg.github.io/tags/linux">linux<sup>7</sup></a></li>
      
      <li><a href="http://sunwxg.github.io/tags/sun-pinyin">sun-pinyin<sup>1</sup></a></li>
      
      <li><a href="http://sunwxg.github.io/tags/wireshark">wireshark<sup>2</sup></a></li>
      
    </ul>
  </div>
  

</aside>

</div>
            <footer>
                <div class="row">
                    

                    <p>&copy; 2016 Sun Wang&#39;s Blog</p>
                    <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>,</p>
                    <p>Theme <a href="https://github.com/sunwxg/my_blog" target="_blank">sun</a> designed by <a href="http://sunwxg.github.io" target="_blank">Sun Wang</a></p>

                    
                </div>
            </footer>
        </div>

        <script src="http://sunwxg.github.io/js/jquery-2.2.0.min.js"></script>
        <script src="http://sunwxg.github.io/js/bootstrap-3.3.6.min.js"></script>
    </body>
</html>

